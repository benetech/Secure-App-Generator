var EventEmitter=require("events").EventEmitter,debug=require("debug")("mocha:suite"),milliseconds=require("./ms"),utils=require("./utils"),Hook=require("./hook");exports=module.exports=Suite;exports.create=function(b,c){var a=new Suite(c,b.ctx);a.parent=b;if(b.pending){a.pending=true}c=a.fullTitle();b.addSuite(a);return a};function Suite(c,a){this.title=c;var b=function(){};b.prototype=a;this.ctx=new b();this.suites=[];this.tests=[];this.pending=false;this._beforeEach=[];this._beforeAll=[];this._afterEach=[];this._afterAll=[];this.root=!c;this._timeout=2000;this._enableTimeouts=true;this._slow=75;this._bail=false;this.delayed=false}Suite.prototype.__proto__=EventEmitter.prototype;Suite.prototype.clone=function(){var a=new Suite(this.title);debug("clone");a.ctx=this.ctx;a.timeout(this.timeout());a.enableTimeouts(this.enableTimeouts());a.slow(this.slow());a.bail(this.bail());return a};Suite.prototype.timeout=function(a){if(0==arguments.length){return this._timeout}if(a.toString()==="0"){this._enableTimeouts=false}if("string"==typeof a){a=milliseconds(a)}debug("timeout %d",a);this._timeout=parseInt(a,10);return this};Suite.prototype.enableTimeouts=function(a){if(arguments.length===0){return this._enableTimeouts}debug("enableTimeouts %s",a);this._enableTimeouts=a;return this};Suite.prototype.slow=function(a){if(0===arguments.length){return this._slow}if("string"==typeof a){a=milliseconds(a)}debug("slow %d",a);this._slow=a;return this};Suite.prototype.bail=function(a){if(0==arguments.length){return this._bail}debug("bail %s",a);this._bail=a;return this};Suite.prototype.beforeAll=function(c,a){if(this.pending){return this}if("function"===typeof c){a=c;c=a.name}c='"before all" hook'+(c?": "+c:"");var b=new Hook(c,a);b.parent=this;b.timeout(this.timeout());b.enableTimeouts(this.enableTimeouts());b.slow(this.slow());b.ctx=this.ctx;this._beforeAll.push(b);this.emit("beforeAll",b);return this};Suite.prototype.afterAll=function(c,a){if(this.pending){return this}if("function"===typeof c){a=c;c=a.name}c='"after all" hook'+(c?": "+c:"");var b=new Hook(c,a);b.parent=this;b.timeout(this.timeout());b.enableTimeouts(this.enableTimeouts());b.slow(this.slow());b.ctx=this.ctx;this._afterAll.push(b);this.emit("afterAll",b);return this};Suite.prototype.beforeEach=function(c,a){if(this.pending){return this}if("function"===typeof c){a=c;c=a.name}c='"before each" hook'+(c?": "+c:"");var b=new Hook(c,a);b.parent=this;b.timeout(this.timeout());b.enableTimeouts(this.enableTimeouts());b.slow(this.slow());b.ctx=this.ctx;this._beforeEach.push(b);this.emit("beforeEach",b);return this};Suite.prototype.afterEach=function(c,a){if(this.pending){return this}if("function"===typeof c){a=c;c=a.name}c='"after each" hook'+(c?": "+c:"");var b=new Hook(c,a);b.parent=this;b.timeout(this.timeout());b.enableTimeouts(this.enableTimeouts());b.slow(this.slow());b.ctx=this.ctx;this._afterEach.push(b);this.emit("afterEach",b);return this};Suite.prototype.addSuite=function(a){a.parent=this;a.timeout(this.timeout());a.enableTimeouts(this.enableTimeouts());a.slow(this.slow());a.bail(this.bail());this.suites.push(a);this.emit("suite",a);return this};Suite.prototype.addTest=function(a){a.parent=this;a.timeout(this.timeout());a.enableTimeouts(this.enableTimeouts());a.slow(this.slow());a.ctx=this.ctx;this.tests.push(a);this.emit("test",a);return this};Suite.prototype.fullTitle=function(){if(this.parent){var a=this.parent.fullTitle();if(a){return a+" "+this.title}}return this.title};Suite.prototype.total=function(){return utils.reduce(this.suites,function(b,a){return b+a.total()},0)+this.tests.length};Suite.prototype.eachTest=function(a){utils.forEach(this.tests,a);utils.forEach(this.suites,function(b){b.eachTest(a)});return this};Suite.prototype.run=function run(){if(this.root){this.emit("run")}};